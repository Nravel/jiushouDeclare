<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	{include file='export-head' /}
	<title>新增图片</title>
	<style>
		.cl {
			padding-left: 15px;
			padding-right: 15px;
		}
		#order-details .panel-heading {
			height: 30px;
			padding: 0 15px;
		}
		#order-details .panel-heading span {
			line-height: 30px;
		}
		#order-details .panel-heading a {
			margin-left: 5px;
			margin-bottom: 3px;
		}
		.oh-content span:first-child,.oh-content span:last-child {
			vertical-align: middle;
		}
		#ohead-submit .btn {
			width: 100px;
		}
		.panel-body {
			overflow-x: hidden;
		}
	</style>
</head>
<body>
<div class="page-container">
	<div id="order-details" class="panel mt-20">
		<div class="panel-heading">
			<span>订单基本信息</span>
			<!--<a title="修改" class="layui-btn layui-btn-mini" lay-event="edit"><i class="Hui-iconfont">&#xe6df;</i></a>-->
			<!--<a href="javascript:;" onclick="searchAdv()" class="directive-close"><i class="layui-icon">&#x1006;</i></a>-->
		</div>
		<div class="panel-body container-fluid">
		</div>
		<div id="ohead-submit" class="text-c">
			<a class="btn  btn-primary radius mt-10 mb-10" data-title="确认修改" href="javascript:;"><i class="Hui-iconfont">&#xe6e1;</i> 确认修改</a>
		</div>
	</div>
	<div class="cl pd-5 bg-1 bk-gray mt-40">
		<span class="l">
			<a href="javascript:;" class=""><i class="layui-icon"></i> 订单商品信息</a>
			<a id="upload_excel" class="btn  btn-danger radius ml-10" data-title="批量删除" href="javascript:;"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>
		</span>
		<span class="r total">共有数据：<strong></strong> 条</span>
	</div>
	<div id="og-details" class="datas">
		<table id="order-goods" lay-filter="ogoods"></table>
	</div>
</div>
{include file='export-footer' /}

<!--请在下方写此页面业务相关的脚本-->
<script id="ohead-show" type="text/html">
	<form class="ohead">
		<ul class="ohead-ul row">
			{{# layui.each(d.hlists,function(index,item) { }}
			<li class="col-xs-4 mb-15">
				<div class="oh-content">
					<span>{{ item.field }}：</span>
					{{# if (item.fieldname!="") { }}
						{{# var re = /^[\u4E00-\u9FA5]+$/ }}
						{{# if (escape(item.content).indexOf( "%u" )==0&&item.content.length>17) { }}
							<span><textarea name={{ item.fieldname }} cols="" rows="" class="textarea">{{ item.content }}</textarea></span>
						{{# }else{ }}
							<span><input name={{ item.fieldname }} class="input-text size-M" type="text" value={{ item.content }}></span>
						{{# } }}
					{{# }else{ }}
						<span>{{ item.content }}</span>
					{{# } }}
				</div>
			</li>
			{{# }); }}
		</ul>
	</form>
</script>
<script type="text/html" id="tools">
	<a title="确认" class="layui-btn layui-btn-mini layui-btn-mini" lay-event="commit" style="background: #5A98DE"><i class="Hui-iconfont">&#xe6e1;</i></a>
	<a title="删除" class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del"><i class="Hui-iconfont">&#xe6e2;</i></a>
</script>
<script type="text/html" id="og-input">
	<input name={{ d.item_name }} class="input-text size-MINI" type="text" value={{# d.item_name }}>
</script>
<script type="text/javascript">
    layui.config({
        debug : true,
        version : true	 //清除缓存
    });
    $(document).ready(function () {
		html = "";
		var og_fields = ["item_name","qty","unit","qty1","unit1","country","hscode","gjcode","gtype","price","total_price","currency"];
		$.each(og_fields,function (index,field) {
			html+= '<script type="text/html\" id="og-input'+(index+1)+'">'+
						'<input name='+field+' class="input-text size-MINI" type="text" value={{ d.'+field+' }}>'+
					'<\/script>';
			$(document.body).append(html);
        })
    });
    layui.use(['laytpl','jquery','table'],function () {
        var laytpl = layui.laytpl;
        var $ = layui.jquery;
        var table = layui.table;

        var headtpl = $("#ohead-show").html();
        var order_no = "{$orderNo='V8152620205'}";
        var res = "";
        //请求对应订单数据
        $.ajax({
            url:"{:url('admin/Order/getOrderDetails')}",
            data: {"orderNo":order_no},
            async : false,
            type: "post",
            success: function (data) {
                res = data.data;
            }
        });
        var headdata = res[0]; //取第一条数据的信息，因为头信息都一样
        var data = {
            hlists: [
                {
                    "field": "订单编号",
                    "content": headdata.order_no,
                    "fieldname": "",
                },
                {
                    "field": "电商平台代码",
                    "content": headdata.ebp_code,
                    "fieldname": "ebp_code",
                },
                {
                    "field": "电商平台名称",
                    "content": headdata.ebp_name,
                    "fieldname": "ebp_name",
                },
                {
                    "field": "电商企业代码",
                    "content": headdata.ebc_code,
                    "fieldname": "ebc_code",
                },
                {
                    "field": "电商企业名称",
                    "content": headdata.ebc_name,
                    "fieldname": "ebc_name",
                },
                {
                    "field": "商品价格",
                    "content": headdata.goods_value,
                    "fieldname": "goods_value",
                },
                {
                    "field": "运杂费",
                    "content": headdata.freight,
                    "fieldname": "freight",
                },
                {
                    "field": "非现金抵扣金额",
                    "content": headdata.discount,
                    "fieldname": "discount",
                },
                {
                    "field": "代扣税款",
                    "content": headdata.tax_total,
                    "fieldname": "tax_total",
                },
                {
                    "field": "实际支付金额",
                    "content": headdata.actural_paid,
                    "fieldname": "actural_paid",
                },
                {
                    "field": "币制",
                    "content": headdata.currency,
                    "fieldname": "currency",
                },
                {
                    "field": "订购人姓名",
                    "content": headdata.buyer_name,
                    "fieldname": "buyer_name",
                },
                {
                    "field": "订购人电话",
                    "content": headdata.buyer_telephone,
                    "fieldname": "buyer_telephone",
                },
                {
                    "field": "订购人证件类型",
                    "content": headdata.buyer_id_type,
                    "fieldname": "buyer_id_type",
                },
                {
                    "field": "订购人证件号码",
                    "content": headdata.buyer_id_number,
                    "fieldname": "buyer_id_number",
                },
                {
                    "field": "收货人姓名",
                    "content": headdata.consignee,
                    "fieldname": "consignee",
                },
                {
                    "field": "收货人电话",
                    "content": headdata.consignee_telephone,
                    "fieldname": "consignee_telephone",
                },
                {
                    "field": "收货地址",
                    "content": headdata.consignee_address,
                    "fieldname": "consignee_address",
                }
            ]
        }
        laytpl(headtpl).render(data,function (html) {
            $(".panel-body").append(html);
        });

        //订单商品信息方法式渲染
        table.render({
            elem: "#order-goods",
            id: "ogoods-main",
            url: "{:url('admin/Order/getOrderDetails')}",
//			height: 200,
            where: {orderNo: order_no},
            cols: [[
                {checkbox: true},
                {field: "gnum",title: "商品序号", width: 100, sort: true},
                {field: "item_name",title: "企业商品名称",width: 200,templet: "#og-input1"},
                {field: "qty",title: "数量",width: 100,templet: "#og-input2", sort: true},
                {field: "unit",title: "计量单位",width: 100,templet: "#og-input3", sort: true},
                {field: "qty1",title: "法定数量",width: 100,templet: "#og-input4", sort: true},
                {field: "unit1",title: "法定计量单位",width: 125,templet: "#og-input5", sort: true},
                {field: "country",title: "原产国",width: 80,templet: "#og-input6"},
                {field: "hscode",title: "海关商品编码(Hscode)",width: 185,templet: "#og-input7", sort: true},
                {field: "gjcode",title: "国检商品编号",width: 150,templet: "#og-input8", sort: true},
                {field: "gtype",title: "商品规格型号",width: 120,templet: "#og-input9"},
                {field: "price",title: "单价",width: 100,templet: "#og-input10", sort: true},
                {field: "total_price",title: "总价",width: 100,templet: "#og-input11", sort: true},
                {field: "currency",title: "币制",width: 70,templet: "#og-input12"},
                {field: 'ctrl', title: '操作', width: 160, toolbar: "#tools", fixed: "right"}
            ]],
//            skin: "row",
//            even: true,
            page: true,
            limits: [2,5,10],
            limit: 5,
            done: function (res,curr,count) {
//				console.log(res);
                $(".total").children("strong").html(count);
            }
        });
        //监听操作工具条
        table.on("tool(ogoods)",function (obj) {
            var data = obj.data;
            console.log(data);
            if (obj.event == "commit") {
//                var url = "{:url('admin/Order/index')}";
//                layer.open({
//                    type: 2,
//                    title: "订单详情",
//                    content:url+'?orderNo='+data.order_no,
//                    area: ['100%','100%']
//                })
            }else if(obj.event == "del") {

            }
        });
    })
</script>
</body>
</html>